---
layout: post
title: ðŸ” Object Detect Comp | 2 Stage Detectors
date: 2021-09-28 07:44 +0900
#modified: 2021-07-30 18:49 +0900
description: ê°ì²´ ê²€ì¶œ ëŒ€íšŒë¥¼ ìœ„í•œ ëª¨ë¸ì„ ë§Œë“œëŠ” ê³¼ì •
tag:
  - Boostcamp AI
  - P-stage
  - Object Detection Competition
# image: /cara-memperbarui-fork-repository/repo.png
usemathjax: true
---

# 2 Stage Detectors

R-CNN, SPPnet, Fast R-CNN, Faster R-CNN

## Background

ì‚¬ëžŒ â†’ ìž…ë ¥ ì´ë¯¸ì§€ â†’ ìƒê°,,, â†’ ìœ„ì¹˜ë³´ê¸°(ë°°ê²½ê³¼ ë‹¤ë¥¸ ë¬´ì–¸ê°€) â†’ ë¬¼ì²´ì´ë¦„ ë§žì¶”ê¸°

ê¸°ê³„ ì¸ê³µì§€ëŠ¥ ë“± ì‚¬ëžŒê³¼ ë¹„ìŠ·í•˜ê²Œ ìƒê°í•¨

ì»´í“¨í„° â†’ ìž…ë ¥ ì´ë¯¸ì§€ â†’ ê³„ì‚° ì¤‘,,, â†’ localization(ê°ì²´ê°€ ìžˆì„ ë²•í•œ ìœ„ì¹˜ ì¶”ì •) â†’ classification(ê°ì²´ ì‹ë³„)

ì•žìœ¼ë¡œ ë°°ìš¸ ê°ì²´ê°€ ìžˆì„ ë²•í•œ ê³³ì„ íŠ¹ì • ì§“ê³  í•´ë‹¹ ê°ì²´ê°€ ë¬´ì—‡ì¸ì§€ì— ëŒ€í•´ì„œ ì‹ë³„ â†’ ì´ ë‘ ë‹¨ê³„ë¥¼ ê±°ì¹˜ëŠ” ëª¨ë¸ì´ 2 stage detectors

## R-CNN

Deep-learningì„ ì´ìš©í•´ì„œ ê°ì²´ ê²€ì¶œì„ í•˜ë ¤ê³  í•œ ìµœì´ˆì˜ íŽ˜ì´í¼

ì´ˆê¸° ëª¨ë¸ì¸ ë§Œí‹ˆ ì§ê´€ì ì´ë‹¤

ìž…ë ¥ ì´ë¯¸ì§€ â†’ ê°ì²´ê°€ ìžˆì„ë²•í•œ í›„ë³´ ì˜ì—­ì„ ì˜ˆì¸¡ (sliding window, selective search) â†’ í›„ë³´ì˜ì—­ì„ ë¦¬ì‚¬ì´ì¦ˆ â†’ CNN â†’ sementic featureë¥¼ ë½‘ìŒ â†’ Classify(ê°ì²´ì•¼! ë­ì•¼! ì•„ë‹ˆì•¼ ë°°ê²½ì´ì•¼!)

Sliding window

ì‚¬ìš©í•  ìˆ˜ ìžˆëŠ” windowì˜ ëª¨ìŠµì€ ë‹¤ì–‘í•˜ë‹¤

ìœˆë„ìš°ë¥¼ í†µí•´ ì´ë¯¸ì§€ë¥¼ í†µê³¼ì‹œí‚¨ë‹¤

í•˜ì§€ë§Œ ì´ë ‡ê²Œ ë½‘ìœ¼ë©´ ë¬´ìˆ˜ížˆ ë§Žì€ í›„ë³´ì˜ì—­ì´ ë‚˜ì˜¬ ê²ƒ â†’ ë¹„íš¨ìœ¨ì 

Selective Search

ì´ë¯¸ì§€ì˜ ìƒ‰ê¹”, ì§ˆê°, shape ì´ë¯¸ì§€ì— ì¡´ìž¬í•˜ëŠ” íŠ¹ì„±ë“¤ì„ í™œìš©, ìž‘ì€ ì˜ì—­ìœ¼ë¡œ ë‚˜ëˆ„ê³  í†µí•©í•´ê°„ë‹¤

ì´ˆê¸°ì—ëŠ” ë§Žì€ í›„ë³´ì˜ì—­ë“¤ì´ ìžˆì§€ë§Œ ì ì°¨ í†µí•©ì„ í•´ë‚˜ê°€ë©´ì„œ segmentationë“¤ì„ ì¤„ì—¬ë‚˜ê°

Pipeline

ìž…ë ¥ ì´ë¯¸ì§€ ë°›ê¸° â†’ selective searchë¥¼ í†µí•´ ì•½ 2000ê°œì˜ RoI(í›„ë³´ì˜ì—­) ì¶”ì¶œ â†’ ì¶”ì¶œëœ í›„ë³´ì˜ì—­ì˜ í¬ê¸°ë¥¼ ì¡°ì ˆí•´ ëª¨ë‘ ë™ì¼í•œ ì‚¬ì´ì¦ˆë¡œ ë³€í˜•(warping) (CNNì˜ ë§ˆì§€ë§‰ì¸ FC layerì˜ ìž…ë ¥ ì‚¬ì´ì¦ˆê°€ ê³ ì •ì´ê¸° ë•Œë¬¸ì—) â†’ RoIë¥¼ CNNì— ë„£ì–´ feature ì¶”ì¶œ â†’ CNNì„ í†µí•´ ë‚˜ì˜¨ 2000ê°œì˜ feature(sementic ì •ë³´ í¬í•¨)ë¥¼ SVMì— ë„£ì–´ ë¶„ë¥˜ ì§„í–‰ â†’ CNNì„ í†µí•´ ë‚˜ì˜¨ featureë¥¼ regressionì„ í†µí•´ bboxë¥¼ ì˜ˆì¸¡ (í›„ë³´ìœ„ì¹˜ë“¤ì„ ë”ìš± ì •í™•í•œ ìœ„ì¹˜ë¡œ ë³€í˜•ì‹œì¼œì£¼ëŠ” ê²ƒ) bboxì˜ ì¤‘ì‹¬ì ì„ ground truthì˜ ì¤‘ì‹¬ì ìœ¼ë¡œ ì˜¯ê¸°ê³  widthì™€ heightê¹Œì§€ ë°”ê¾¸ëŠ” ë¸íƒ€ë¥¼ í•™ìŠµ

Training

AlexNet

- Domain specific finetuning
- Dataset
    - IoU > 0.5
    - IoU < 0.5
    - Positive samples 32, negative sampels 96
- Heard negative mining
    - Hard negative: False positive
    - ë°°ê²½ìœ¼ë¡œ ì‹ë³„í•˜ê¸° ì–´ë ¤ìš´ ìƒ˜í”Œë“¤ì„ ê°•ì œë¡œ ë‹¤ìŒ ë°°ì¹˜ì˜ negative sampleë¡œ mining
    - ëª¨ë¸ì´ êµ¬ë¶„í•˜ê¸° ì–´ë ¤ìš´ ìƒ˜í”Œë“¤ì„ ë‹¤ìŒ ë°°ì¹˜ì— ì¶”ê°€ì‹œì¼œì„œ í•™ìŠµì‹œí‚¤ëŠ” ê²ƒ
- Bbox regressor
    - Dataset êµ¬ì„±
        - IoU > 0.6: positive
- Loss
    - MSE Loss

Shortcomings

- 2000ê°œì˜ regionì„ ê°ê° CNN í†µê³¼
- ë‹¤ì–‘í•œ ê°ì²´ ì‚¬ì´ì¦ˆë¥¼ ê°•ì œ warping (ì •ë³´ ì†ì‹¤) ì„±ëŠ¥ í•˜ë½ ê°€ëŠ¥ì„±
- CNN, SVM, bbox regressor ë”°ë¡œ í•™ìŠµ
- End-to-end X êµ¬ì¡°ì ì¸ ì¸¡ë©´ì—ì„œ í•œê³„ì ì„ ê°€ì§„

## SPPNet

Overview

image â†’ crop/warp â†’ conv layers â†’ fc layers â†’ output

image â†’ conv layers â†’ spatial pyramid pooling â†’ fc layers â†’ output

Conv neural net ìˆ˜í–‰ì„ feature extractionì„ í•œë²ˆë§Œ ìˆ˜í–‰í•˜ë©´ ëœë‹¤

Spatial Pyramid Pooling

ë½‘ì•„ë†“ì€ feature mapì—ì„œ 2000ê°œì˜ regionì„ ë½‘ìŒ warpingí•˜ì§€ ì•Šê³  spatial pyramid poolingì„ í†µí•´ì„œ ê³ ì •ëœ ì‚¬ì´ì¦ˆë¡œ ë³€í™˜

ì–´ë– í•œ RoI projectionì„ í†µí•´ì„œ 2000ê°œì˜ regionì„ ë½‘ëŠ”ë‹¤ ë‹¤ì–‘í•œ ì‚¬ì´ì¦ˆ ê³ ì •ëœ feature vectorë¡œ ë³€í™˜í•˜ê¸° ìœ„í•´ì„œ spp

ë‹¤ì–‘í•œ roië¡œ ë¶€í„° target feature sizeë¥¼ ì •í•œë‹¤

## Fast R-CNN

spatial pyramid pooling â†’ RoI pooling

ê³ ì •ëœ ì‚¬ì´ì¦ˆì˜ feature vector

- VGG16 ì‚¬ìš©
- RoI Projectì„ í†µí•´ feature map ìƒì—ì„œ RoI ê³„ì‚°
    - selective searchë¥¼ ì ìš©í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥
    - selective search 2000ê°œì˜ region, RoIë“¤ì„ ë½‘ì•„ì˜´
    - ê·¸ regionë“¤ì„ feature mapìƒì— íˆ¬ì˜ì‹œí‚´
    - CNNì„ í†µê³¼í•´ì„œ ì›ë³¸ ì´ë¯¸ì§€ ë³´ë‹¤ ìž‘ì•„ì¡Œì„ë•Œ, ë¹„ìœ¨ì„ ë§žì¶°ì„œ regionì„ ì¶•ì†Œì‹œì¼œì•¼í•¨
- RoI poolingì„ í†µí•´ì„œ ê³ ì •ëœ ì‚¬ì´ì¦ˆì˜ feature ì¶”ì¶œ
- fully connected layer ì´í›„, softmax classifier, bounding bbox
- multi task loss ì‚¬ìš© (classification loss, bbox regression)
    - class: Cross entropy
    - bbox: Smooth L1
- Dataset êµ¬ì„±
    - IoU > 0.5
    - 0.1 < IoU < 0.5
- Hierarchical sampling
- selective search â†’ CPU ìƒì—ì„œ ëŒì•„ê°, í•™ìŠµê°€ëŠ¥í•œ ì•Œê³ ë¦¬ì¦˜ x â†’ ì§„ì •í•œ end-to-endê°€ ì•„ë‹˜

## Faster R-CNN

RPN â†’ Region Proposalë„ í•™ìŠµ ê°€ëŠ¥í•˜ê²Œ ë°”ê¿”ì¤Œ

conv feature mapì—ì„œ ì–´ë–»ê²Œ regionì„ ë½‘ëŠ”ê°€?

nê°œì˜ Anchor box ì •ì˜ â†’ ê°ì²´ ì‚¬ì´ì¦ˆì— ë”°ë¼ì„œ ëŒ€ì‘ ê°€ëŠ¥

feature map ê° ì…€ë§ˆë‹¤ kê°œì˜ anchor boxê°€ ìžˆë‹¤

RPNì´ ê·¸ anchor boxì— ê°ì²´ê°€ í¬í•¨ë˜ì–´ ìžˆëŠ”ì§€ ì•„ë‹Œì§€ íŒë‹¨í•œë‹¤

ìžˆë‹¤ë©´ resiteí•˜ê³  í¬ê¸°ë¥¼ ì¡°ì •í•œë‹¤

NMS

ê²¹ì¹˜ëŠ” ì˜ì—­ì´ ë§¤ìš° ë§Žì„ ìˆ˜ë„ ìžˆë‹¤

IoUê°€ 0.7ì´ìƒì´ë©´ ì¤‘ë³µëì„ ê°€ëŠ¥ì„±ì´ ë†’ì•„ ì œê±°í•œë‹¤ â†’ class scoreë¥¼ 0ìœ¼ë¡œ ë°”ê¿”ì¤Œ